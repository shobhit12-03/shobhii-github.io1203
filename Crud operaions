#include <stdio.h>
#include <stdlib.h>

struct User {
    int id;
    char name[50];
    int age;
};

void createUser();
void readUsers();
void updateUser();
void deleteUser();

int main() {
    int c;
    while (1) {
        printf("\n1.Create\n2.Read\n3.Update\n4.Delete\n5.Exit\nEnter choice: ");
        scanf("%d", &c);
        if (c == 1) createUser();
        else if (c == 2) readUsers();
        else if (c == 3) updateUser();
        else if (c == 4) deleteUser();
        else if (c == 5) break;
        else printf("Invalid choice\n");
    }
    return 0;
}

void createUser() {
    struct User u;
    FILE *f = fopen("users.txt", "a");
    if (!f) return;
    printf("Enter ID Name Age: ");
    scanf("%d %s %d", &u.id, u.name, &u.age);
    fprintf(f, "%d %s %d\n", u.id, u.name, u.age);
    fclose(f);
}

void readUsers() {
    struct User u;
    FILE *f = fopen("users.txt", "r");
    if (!f) { printf("No records\n"); return; }
    while (fscanf(f, "%d %s %d", &u.id, u.name, &u.age) == 3)
        printf("ID:%d Name:%s Age:%d\n", u.id, u.name, u.age);
    fclose(f);
}

void updateUser() {
    struct User u;
    FILE *f = fopen("users.txt", "r"), *t = fopen("temp.txt", "w");
    if (!f) { printf("No records\n"); return; }
    int id, found = 0;
    printf("Enter ID to update: ");
    scanf("%d", &id);
    while (fscanf(f, "%d %s %d", &u.id, u.name, &u.age) == 3) {
        if (u.id == id) {
            found = 1;
            printf("Enter new Name and Age: ");
            scanf("%s %d", u.name, &u.age);
        }
        fprintf(t, "%d %s %d\n", u.id, u.name, u.age);
    }
    fclose(f); fclose(t);
    remove("users.txt");
    rename("temp.txt", "users.txt");
    if (found) printf("Updated\n"); else printf("ID not found\n");
}

void deleteUser() {
    struct User u;
    FILE *f = fopen("users.txt", "r"), *t = fopen("temp.txt", "w");
    if (!f) { printf("No records\n"); return; }
    int id, found = 0;
    printf("Enter ID to delete: ");
    scanf("%d", &id);
    while (fscanf(f, "%d %s %d", &u.id, u.name, &u.age) == 3) {
        if (u.id != id) fprintf(t, "%d %s %d\n", u.id, u.name, u.age);
        else found = 1;
    }
    fclose(f); fclose(t);
    remove("users.txt");
    rename("temp.txt", "users.txt");
    if (found) printf("Deleted\n"); else printf("ID not found\n");
}
