#include <stdio.h>
#include <stdlib.h>
#include <string.h>

typedef enum
{
    Batsman = 1,
    Bowler,
    AllRounder
} Role;

typedef struct Player
{
    int playerId;
    char name[51];
    char teamName[51];
    Role role;
    int totalRuns;
    float battingAverage;
    float strikeRate;
    int wickets;
    float economyRate;
    float performanceIndex;
    struct Player *next;
} Player;

typedef struct Team
{
    int teamId;
    char name[51];
    int totalPlayers;
    float averageBattingStrikeRate;
    Player *players;
} Team;

Team teams[10] = {
    {1, "India", 0, 0, NULL},
    {2, "Australia", 0, 0, NULL},
    {3, "England", 0, 0, NULL},
    {4, "Pakistan", 0, 0, NULL},
    {5, "New Zealand", 0, 0, NULL},
    {6, "South Africa", 0, 0, NULL},
    {7, "Bangladesh", 0, 0, NULL},
    {8, "Sri Lanka", 0, 0, NULL},
    {9, "Afghanistan", 0, 0, NULL},
    {10, "West Indies", 0, 0, NULL}};

int teamCount = 10;

float calculatePerformanceIndex(Player *p)
{
    if (p->role == Batsman)
    {
        return (p->battingAverage * p->strikeRate) / 100;
    }
    else if (p->role == Bowler)
    {
        return (p->wickets * 2) + (100 - p->economyRate);
    }
    else
    {
        return (p->battingAverage * p->strikeRate) / 100 + (p->wickets * 2);
    }
}

Team *searchTeam(int teamId)
{
    int low = 0, high = teamCount - 1;
    while (low <= high)
    {
        int mid = (low + high) / 2;
        if (teams[mid].teamId == teamId)
        {
            return &teams[mid];
        }
        else if (teams[mid].teamId < teamId)
        {
            low = mid + 1;
        }
        else
        {
            high = mid - 1;
        }
    }
    return NULL;
}

void addPlayerToTeam()
{
    int teamId;
    printf("Enter Team ID to add player: ");
    scanf("%d", &teamId);
    Team *team = searchTeam(teamId);
    if (!team)
        return;
    Player *p = (Player *)malloc(sizeof(Player));
    printf("Player ID: ");
    scanf("%d", &p->playerId);
    printf("Name: ");
    scanf(" %[^\n]", p->name);
    printf("Role (1-Batsman, 2-Bowler, 3-All-rounder): ");
    scanf("%d", (int *)&p->role);
    printf("Total Runs: ");
    scanf("%d", &p->totalRuns);
    printf("Batting Average: ");
    scanf("%f", &p->battingAverage);
    printf("Strike Rate: ");
    scanf("%f", &p->strikeRate);
    printf("Wickets: ");
    scanf("%d", &p->wickets);
    printf("Economy Rate: ");
    scanf("%f", &p->economyRate);
    strcpy(p->teamName, team->name);
    p->performanceIndex = calculatePerformanceIndex(p);
    p->next = team->players;
    team->players = p;
    team->totalPlayers++;
    printf("Player added successfully to Team %s!\n", team->name);
}

void displayPlayersOfTeam()
{
    int teamId;
    printf("Enter Team ID: ");
    scanf("%d", &teamId);
    Team *team = searchTeam(teamId);
    if (!team)
        return;
    Player *curr = team->players;
    int count = 0;
    float totalSR = 0;
    printf("Players of Team %s:\n", team->name);
    printf("ID Name Role Runs Avg SR Wkts ER Perf.Index\n");
    while (curr)
    {
        printf("%d %s %d %d %.1f %.1f %d %.1f %.2f\n",
               curr->playerId, curr->name, curr->role, curr->totalRuns,
               curr->battingAverage, curr->strikeRate, curr->wickets,
               curr->economyRate, curr->performanceIndex);
        if (curr->role != Bowler)
            totalSR += curr->strikeRate;
        curr = curr->next;
        count++;
    }
    team->averageBattingStrikeRate = count ? totalSR / count : 0;
    printf("Total Players: %d\n", count);
    printf("Average Batting Strike Rate: %.2f\n", team->averageBattingStrikeRate);
}

void swapTeams(Team *a, Team *b)
{
    Team temp = *a;
    *a = *b;
    *b = temp;
}

void displayTeamsByBatSR()
{
    for (int i = 0; i < teamCount - 1; i++)
    {
        for (int j = i + 1; j < teamCount; j++)
        {
            if (teams[i].averageBattingStrikeRate < teams[j].averageBattingStrikeRate)
            {
                swapTeams(&teams[i], &teams[j]);
            }
        }
    }
    printf("Teams Sorted by Average Batting Strike Rate\n");
    printf("ID Team Name Avg Bat SR Total Players\n");
    for (int i = 0; i < teamCount; i++)
    {
        printf("%d %s %.1f %d\n", teams[i].teamId, teams[i].name,
               teams[i].averageBattingStrikeRate, teams[i].totalPlayers);
    }
}

Player **gatherPlayersByRole(Role role, int *count)
{
    Player **arr = (Player **)malloc(200 * sizeof(Player *));
    int idx = 0;
    for (int i = 0; i < teamCount; i++)
    {
        Player *curr = teams[i].players;
        while (curr)
        {
            if (curr->role == role)
            {
                arr[idx++] = curr;
            }
            curr = curr->next;
        }
    }
    *count = idx;
    return arr;
}

int comparePlayer(const void *a, const void *b)
{
    Player *p1 = *(Player **)a;
    Player *p2 = *(Player **)b;
    if (p1->performanceIndex < p2->performanceIndex)
        return 1;
    if (p1->performanceIndex > p2->performanceIndex)
        return -1;
    return 0;
}

void displayTopKPlayersByRole()
{
    int teamId, k;
    Role role;
    printf("Enter Team ID: ");
    scanf("%d", &teamId);
    Team *team = searchTeam(teamId);
    if (!team)
        return;
    printf("Enter Role (1-Batsman, 2-Bowler, 3-All-rounder): ");
    scanf("%d", (int *)&role);
    printf("Enter number of players: ");
    scanf("%d", &k);
    Player *curr = team->players;
    Player **arr = (Player **)malloc(team->totalPlayers * sizeof(Player *));
    int idx = 0;
    while (curr)
    {
        if (curr->role == role)
            arr[idx++] = curr;
        curr = curr->next;
    }
    qsort(arr, idx, sizeof(Player *), comparePlayer);
    for (int i = 0; i < k && i < idx; i++)
    {
        Player *p = arr[i];
        printf("%d %s %.2f\n", p->playerId, p->name, p->performanceIndex);
    }
    free(arr);
}

void displayAllPlayersByRole()
{
    Role role;
    printf("Enter Role (1-Batsman, 2-Bowler, 3-All-rounder): ");
    scanf("%d", (int *)&role);
    int count;
    Player **arr = gatherPlayersByRole(role, &count);
    qsort(arr, count, sizeof(Player *), comparePlayer);
    for (int i = 0; i < count; i++)
    {
        Player *p = arr[i];
        printf("%d %s %s %.2f\n", p->playerId, p->name, p->teamName, p->performanceIndex);
    }
    free(arr);
}

int main()
{
    int choice;
    do
    {
        printf("1. Add Player to Team\n");
        printf("2. Display Players of a Specific Team\n");
        printf("3. Display Teams by Average Batting Strike Rate\n");
        printf("4. Display Top K Players of a Specific Team by Role\n");
        printf("5. Display all Players of specific role Across All Teams\n");
        printf("6. Exit\n");
        printf("Enter your choice: ");
        scanf("%d", &choice);
        if (choice == 1)
            addPlayerToTeam();
        else if (choice == 2)
            displayPlayersOfTeam();
        else if (choice == 3)
            displayTeamsByBatSR();
        else if (choice == 4)
            displayTopKPlayersByRole();
        else if (choice == 5)
            displayAllPlayersByRole();
    } while (choice != 6);
    return 0;
}
